{"ast":null,"code":"import { enrichEventWithDetails } from '@ui5/webcomponents-react-base';\nimport clsx from 'clsx';\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nexport const VirtualTableBodyContainer = props => {\n  const {\n    tableBodyHeight,\n    totalColumnsWidth,\n    children,\n    parentRef,\n    classes,\n    infiniteScroll,\n    infiniteScrollThreshold,\n    onLoadMore,\n    rows,\n    internalRowHeight,\n    handleExternalScroll,\n    visibleRows,\n    popInRowHeight,\n    dataLength\n  } = props;\n  const [isMounted, setIsMounted] = useState(false);\n  useEffect(() => {\n    if (parentRef.current) {\n      setIsMounted(true);\n    }\n  }, [parentRef.current]);\n  const classNames = clsx(classes.tbody);\n  const lastScrollTop = useRef(0);\n  const firedInfiniteLoadEvents = useRef(new Set());\n  const prevDataLength = useRef(dataLength);\n  useEffect(() => {\n    if (prevDataLength.current > dataLength) {\n      firedInfiniteLoadEvents.current.clear();\n      parentRef.current.scrollTop = 0;\n      lastScrollTop.current = 0;\n    }\n    prevDataLength.current = dataLength;\n  }, [dataLength]);\n  const onScroll = useCallback(event => {\n    handleExternalScroll(enrichEventWithDetails(event, {\n      rows,\n      rowElements: event.target.children[0].children\n    }));\n    const scrollOffset = event.target.scrollTop;\n    const isScrollingDown = lastScrollTop.current < scrollOffset;\n    if (isScrollingDown && infiniteScroll) {\n      lastScrollTop.current = scrollOffset;\n      const currentLastRow = Math.floor(scrollOffset / popInRowHeight) + (popInRowHeight === internalRowHeight ? visibleRows : Math.floor(tableBodyHeight / popInRowHeight));\n      if (rows.length - currentLastRow < infiniteScrollThreshold) {\n        if (!firedInfiniteLoadEvents.current.has(rows.length)) {\n          const rootNodes = rows.filter(row => row.depth === 0);\n          onLoadMore({\n            detail: {\n              rowCount: rootNodes.length,\n              totalRowCount: rows.length\n            }\n          });\n        }\n        firedInfiniteLoadEvents.current.add(rows.length);\n      }\n    }\n  }, [infiniteScroll, infiniteScrollThreshold, onLoadMore, rows, internalRowHeight, firedInfiniteLoadEvents, lastScrollTop, handleExternalScroll, popInRowHeight, tableBodyHeight]);\n  return React.createElement(\"div\", {\n    className: classNames,\n    ref: parentRef,\n    onScroll: onScroll,\n    style: {\n      position: 'relative',\n      overflowY: 'auto',\n      height: `${tableBodyHeight}px`,\n      width: `${totalColumnsWidth}px`\n    },\n    \"data-component-name\": \"AnalyticalTableBody\"\n  }, isMounted && children);\n};","map":{"version":3,"names":["enrichEventWithDetails","clsx","React","useCallback","useEffect","useRef","useState","VirtualTableBodyContainer","props","tableBodyHeight","totalColumnsWidth","children","parentRef","classes","infiniteScroll","infiniteScrollThreshold","onLoadMore","rows","internalRowHeight","handleExternalScroll","visibleRows","popInRowHeight","dataLength","isMounted","setIsMounted","current","classNames","tbody","lastScrollTop","firedInfiniteLoadEvents","Set","prevDataLength","clear","scrollTop","onScroll","event","rowElements","target","scrollOffset","isScrollingDown","currentLastRow","Math","floor","length","has","rootNodes","filter","row","depth","detail","rowCount","totalRowCount","add","createElement","className","ref","style","position","overflowY","height","width"],"sources":["/home/user/projects/reactwithcap01/reactmodule01/node_modules/@ui5/webcomponents-react/dist/components/AnalyticalTable/TableBody/VirtualTableBodyContainer.js"],"sourcesContent":["import { enrichEventWithDetails } from '@ui5/webcomponents-react-base';\nimport clsx from 'clsx';\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nexport const VirtualTableBodyContainer = (props) => {\n    const { tableBodyHeight, totalColumnsWidth, children, parentRef, classes, infiniteScroll, infiniteScrollThreshold, onLoadMore, rows, internalRowHeight, handleExternalScroll, visibleRows, popInRowHeight, dataLength } = props;\n    const [isMounted, setIsMounted] = useState(false);\n    useEffect(() => {\n        if (parentRef.current) {\n            setIsMounted(true);\n        }\n    }, [parentRef.current]);\n    const classNames = clsx(classes.tbody);\n    const lastScrollTop = useRef(0);\n    const firedInfiniteLoadEvents = useRef(new Set());\n    const prevDataLength = useRef(dataLength);\n    useEffect(() => {\n        if (prevDataLength.current > dataLength) {\n            firedInfiniteLoadEvents.current.clear();\n            parentRef.current.scrollTop = 0;\n            lastScrollTop.current = 0;\n        }\n        prevDataLength.current = dataLength;\n    }, [dataLength]);\n    const onScroll = useCallback((event) => {\n        handleExternalScroll(enrichEventWithDetails(event, { rows, rowElements: event.target.children[0].children }));\n        const scrollOffset = event.target.scrollTop;\n        const isScrollingDown = lastScrollTop.current < scrollOffset;\n        if (isScrollingDown && infiniteScroll) {\n            lastScrollTop.current = scrollOffset;\n            const currentLastRow = Math.floor(scrollOffset / popInRowHeight) +\n                (popInRowHeight === internalRowHeight ? visibleRows : Math.floor(tableBodyHeight / popInRowHeight));\n            if (rows.length - currentLastRow < infiniteScrollThreshold) {\n                if (!firedInfiniteLoadEvents.current.has(rows.length)) {\n                    const rootNodes = rows.filter((row) => row.depth === 0);\n                    onLoadMore({\n                        detail: {\n                            rowCount: rootNodes.length,\n                            totalRowCount: rows.length\n                        }\n                    });\n                }\n                firedInfiniteLoadEvents.current.add(rows.length);\n            }\n        }\n    }, [\n        infiniteScroll,\n        infiniteScrollThreshold,\n        onLoadMore,\n        rows,\n        internalRowHeight,\n        firedInfiniteLoadEvents,\n        lastScrollTop,\n        handleExternalScroll,\n        popInRowHeight,\n        tableBodyHeight\n    ]);\n    return (React.createElement(\"div\", { className: classNames, ref: parentRef, onScroll: onScroll, style: {\n            position: 'relative',\n            overflowY: 'auto',\n            height: `${tableBodyHeight}px`,\n            width: `${totalColumnsWidth}px`\n        }, \"data-component-name\": \"AnalyticalTableBody\" }, isMounted && children));\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}